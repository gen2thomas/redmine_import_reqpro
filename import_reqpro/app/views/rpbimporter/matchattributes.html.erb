<% content_for :header_tags do %>
    <%= stylesheet_link_tag 'rpbimporter', :plugin => 'import_reqpro' %>
<% end %>

<% if !flash[:error] %>
	<h2>
	<% if @attributes_keys_sorted != nil %>
		<%= l(:label_match_attributes) %>
	<% else %>
		<%= l(:label_match_norpattributes) %>
	<% end %>
	</h2>
	<% form_tag({:action => 'do_import_and_result'}, {:multipart => true}) do %>
		<%= render :partial => "progress_bar" %><br/>
		<% if @attributes_keys_sorted != nil %>
			<legend><%= l(:label_matchattributes_select) %></legend>
			<h3><%= l(:label_used_attributes) %></h3>
			<table class="list">
				<tbody>
					<% @attributes_keys_sorted.each do |col_key| %>
						<%column= @attributes_for_view[col_key]%>
				    	<%matched = ''
				          @attrs.each do |k| if k.to_s.casecmp(column[:attrlabel].to_s) == 0 then matched = k end end
				        %>
				        <tr class="<%= cycle("odd", "even") %>">
						 	<td><%= column[:projects].to_a.join("/") %>.<%= column[:rtprefixes].to_a.join("/") %>.<%= column[:attrlabel] %>:</td>
						 	<td><%= select_tag "fields_map_attribute[#{col_key}]", "<option value=\"\">#{l(:option_ignore)}</option>" + "<option value='#{column[:attrlabel]}'>+#{column[:attrlabel]}</option>" +
								options_for_select(@attrs, matched) %></td>
							<td>@<%= column[:datatypes] %>: <%= column[:itemtext].to_a.join(", ")%></td> 
						</tr>
					<% end %>
				</tbody>
			</table>
		<% else %>
			<%= l(:label_no_rpattributes) %><br/><br/>
		<% end %>
		<fieldset class="box"><legend><%= l(:label_issue_import_settings) %></legend>
			<label><%= check_box_tag "issue_update_allowed", true, false %> <%= l(:label_issue_update_allowed) %> </label><br/>
		</fieldset>
		
		<%= submit_tag l(:button_start_import) %>
	<% end %>
<% end %>
<hr/>
